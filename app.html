<!DOCTYPE html>
<html lang="da">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Tekstlab – Eventyr og viser</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400;0,500;0,700;1,400&family=IM+Fell+English:ital@0;1&display=swap"
      rel="stylesheet"
    />
  <link rel="stylesheet" href="include/layout.css">
  </head>
  <body>
    <div class="wrap">
      <header>
        <h1><code>TxtLab/</code> Folkeeventyr og -viser</h1>

        <!--
        <div class="small">
          Marker <b>plottilstande</b> vs. <b>form-signaler</b> (omkvæd/burden),
          byg automatisk et Mermaid-plotdiagram, og eksporter Markov-tabel +
          skabelon.
        </div>
        -->
        
      </header>

      <section class="grid" style="margin-top: 14px">
        <div class="card pad">
          <h3>Tekst og opmærkning</h3>
          <div class="bar" style="margin-bottom: 8px">
            <select id="kindSel" title="Type mærkning">
              <option value="PLOT">Plottilstand</option>
              <option value="SIGNAL">Form-signal</option>
            </select>
            <select id="labelSel" title="Vælg label"></select>
            <button id="btnTag">Opmærk tekst</button>
            <button id="btnClearSel" class="secondary">Ryd opmærkning</button>
            <!--<button id="btnExport" class="secondary">Eksportér JSON</button>-->
            <label
              class="secondary label-disabled"
              style="
                padding: 8px 12px;
                border-radius: 10px;
                border: 1px solid var(--border);
                background: #fff;
                cursor: pointer;
              "
              >Importér
              <input
                id="fileImport"
                type="file"
                accept="application/json"
                style="display: none"
              />
            </label>
          </div>
          <textarea
            id="textInput"
            placeholder="Indsæt eller skriv en folkevise/folketekst her. Markér en passage, vælg type + label, og klik ‘Mærk markering’."
          ></textarea>
          <div style="margin-top: 10px" class="card pad">
            <h4 style="margin: 0 0 6px">Forhåndsvisning</h4>
            <div id="preview" class="mono" style="white-space: pre-wrap"></div>
          </div>
          <div style="margin-top: 10px" class="card pad">
            <h4 style="margin: 0 0 6px">Opmærkning</h4>
            <div id="annList" class="list small"></div>
          </div>
        </div>

        <div class="card pad">
          <h3>Tilstandsmaskine</h3>
          <div class="small">
            <strong>Forklaring:</strong> rektanglerne (kaldes også <i>knuder</i>) illustrerer <u>tilstande</u>. faste pile = plotovergange; prikkede selv-løkker = om- eller mellemkvæd.
            Kantlabels viser sandsynligheder ud fra dine mærkninger.
          </div>
          <div class="bar" style="margin: 8px 0">
            <button id="btnBuildGraph">Byg diagram</button>
            <!--
            <button id="btnDownloadMermaid" class="secondary">
              Download (.png)
            </button>
          -->
            <button id="btnDownloadMermaid" class="icon-btn secondary" aria-label="Download Mermaid (.mmd)" title="Download (.png)">
          <!-- Simple download icon -->
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
              stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
            <path d="M7 10l5 5 5-5"/>
            <path d="M12 15V3"/>
          </svg>
          <span class="sr-only">Download (.png)</span>
        </button>
          </div>
          <div id="mermaidBox" class="flow">
            <div class="small">Klik “Byg diagram”.</div>
          </div>
          <!--
          <div class="card pad" style="margin-top: 10px">
            <h4 style="margin: 0 0 6px">Markov-tabel</h4>
            <div class="small">
              Optællinger og sandsynligheder beregnet fra rækkefølgen af
              opmærkninger.
            </div>
            <pre id="markovOut" class="mono template out" style="margin: 0">
— ingen —</pre>
            <div class="bar" style="margin-top: 8px">
              <button id="btnDownloadCSV" class="secondary">
                Download CSV
              </button>
            </div>
          </div>
        -->
        </div>
      </section>

      <section class="grid" style="margin-top: 14px">
        <div class="card pad">
          <h3>Skabelonudtræk</h3>
          <div class="bar">
            <label class="small"
              ><input id="includeSignals" type="checkbox" checked /> medtag
              form-signaler i skabelon (f.eks. &lt;&lt;OMKVÆD&gt;&gt;)</label
            >
            <button id="btnExtract">Udtræk skabelon</button>
            <button id="btnCopyTemplate" class="secondary">Kopiér</button>
            <button id="btnDownloadTemplate" class="icon-btn secondary" aria-label="Download (.txt)" title="Download (.txt)">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
              <path d="M7 10l5 5 5-5"/>
              <path d="M12 15V3"/>
            </svg>
            <span class="sr-only">Download (.txt)</span>
          </button>
          </div>
          <pre
            id="templateOut"
            class="mono template out"
            style="margin-top: 8px"
          >
— ingen —</pre
          >
        </div>
        <!--
        <div class="card pad">
          <h3>Forklarende oversigter</h3>
          <div class="small">
            Plot-labels (til hoveddiagrammet) og Form-signaler
            (prosodiske/performative markører).
          </div>
          <div id="legendPlot" class="legend" style="margin-top: 8px"></div>
          <div id="legendSignal" class="legend" style="margin-top: 8px"></div>
        </div>
        -->
      </section>
    </div>

    <!-- Mermaid -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script>
      mermaid.initialize({
        startOnLoad: false,
        theme: "default",
        securityLevel: "loose",
      });
    </script>
    <script src="include/logic.js"></script>
  </body>
</html>
